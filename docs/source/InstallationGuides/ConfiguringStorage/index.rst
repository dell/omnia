Configuring Storage
=====================

**Configuring Powervault Storage**

To configure powervault ME4 and ME5 storage arrays, follow the below steps:

Fill out all required parameters in ``storage/powervault_input.yml``:

+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter                      | Default, Accepted values          | Required? | Additional information                                                                                                                                                                                                                                  |
+================================+===================================+===========+=========================================================================================================================================================================================================================================================+
| powervault_protocol            | **sas**                           | Required  | This variable indicates the   network protocol used for data connectivity                                                                                                                                                                               |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_controller_mode     | **multi**, single                 | Required  |  This variable indicates the number of   controllers available on the target powervault.                                                                                                                                                                |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_locale              | **English**                       | Optional  | Represents   the selected language. Currently, only English is supported.                                                                                                                                                                               |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_system_name         | Unintialized_Name                 | Optional  | The system name used to identify the   PowerVault Storage device. The name should be less than 30 characters and   must not contain spaces.                                                                                                             |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_snmp_notify_level   | none                              | Required  | Select   the SNMP notification levels for PowerVault Storage devices.                                                                                                                                                                                   |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_pool_type           | **linear**, virtual               | Required  | This variable indicates the kind of pool   created on the target powervault.                                                                                                                                                                            |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_raid_levels         | **raid1**,   raid5, raid6, raid10 | Optional  | Enter   the required RAID levels and the minimum and maximum number of disks for each   RAID levels.                                                                                                                                                    |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_disk_range          | **0.1-1**                         | Required  | Enter the range of disks in the format   enclosure-number.disk-range,enclosure-number.disk-range. For example, to   select disks 3 to 12 in enclosure 1 and to select disks 5 to 23 in enclosure   2, you must enter 1.3-12, 2.5-23.                    |
|                                |                                   |           |                                                                                                                                                                                                                                                         |
|                                |                                   |           | A RAID 10 or 50 disk group with disks in subgroups are separated by colons   (with no spaces). RAID-10 example:1.1-2:1.3-4:1.7,1.10                                                                                                                     |
|                                |                                   |           |                                                                                                                                                                                                                                                         |
|                                |                                   |           | Note: Ensure that the entered disk location is empty and the Usage column   lists the range as AVAIL. The disk range specified must be of the same vendor   and they must have the same description.                                                    |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_disk_group_name     | omnia                             | Required  | Specifies   the disk group name                                                                                                                                                                                                                         |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_volumes             | omnia_home                        | Required  | Specify the volume details for   powervault and NFS Server node. Multiple volumes can be defined as comma   seperated values. example: omnia_home1, omnia_home2.                                                                                        |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_volume_size         | 100GB                             | Required  | Enter   the volume size in the format: SizeGB.                                                                                                                                                                                                          |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_pool                | **a**, A, B, b                    | Required  | Enter the pool for the volume.                                                                                                                                                                                                                          |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_disk_partition_size |                                   | Optional  | Specify the disk partition   size as a percentage of available disk space.                                                                                                                                                                              |
|                                |                                   |           |                                                                                                                                                                                                                                                         |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_server_nic          |                                   | Optional  |  Enter the NIC of the server to which the   PowerVault Storage is connected.  Make   sure nfs server also has 3 nics (for internet, OS provision and powervault   connection). The nic should be specified based on the provisioned OS on nfs   server. |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| snmp_trap_destination          |                                   | Optional  |  The trap destination IP address is the IP   address of the SNMP Server where the trap will be sent. If this variable is   left blank, SNMP will be disabled. Omnia will not validate this IP.                                                          |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| snmp_community_name            | public                            | Optional  | The SNMP community string used to access   statistics, MAC addresses and IPs stored within a router or other device.                                                                                                                                    |
+--------------------------------+-----------------------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Run the playbook: ::

    cd storage
    ansible-playbook powervault.yml -i inventory -e powervault_username="" -e powervault_password=""

* Where the ``inventory`` refers to a list of all nodes separated by a newline.

* ``powervault_username`` and ``powervault_password`` are the credentials used to administrate the array.


**Configuring NFS servers**

To configure an NFS server, enter the following parameters in ``storage/nfs_server_input.yml``

+--------------------+----------------------------------------------------------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter          | Default, Accepted values                                                               | Required? | Additional information                                                                                                                                                                                                                                                                                                                                                                                                                                |
+====================+========================================================================================+===========+=======================================================================================================================================================================================================================================================================================================================================================================================================================================================+
| powervault_ip      |                                                                                        | Optional  | Mandatory   field when nfs_node group is defined with an IP and omnia is required to   configure nfs server. IP of Powervault connected to NFS Server should be   provided. In a single run of omnia, only one NFS Server is configured. To   configure multiple NFS Servers, add one IP in nfs_node group in a single run   of omnia.yml and give variable values accordingly. To configure another nfs   node, update variables and run nfs_sas.yml |
+--------------------+----------------------------------------------------------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_volumes |  "- { name: omnia_home, server_share_path: /home/omnia_home, server_export_options: }" | Required  | Specify the volume details for powervault and NFS Server node                                                                                                                                                                                                                                                                                                                                                                                         |
|                    |                                                                                        |           |      For multiple volumes, list of json with volume details should be   provided.                                                                                                                                                                                                                                                                                                                                                                     |
|                    |                                                                                        |           |      	server_share_path: The path at which volume is mounted on nfs_node                                                                                                                                                                                                                                                                                                                                                                               |
|                    |                                                                                        |           |      	server_export_options: Default value is- rw,sync,no_root_squash (unless   specified otherwise)                                                                                                                                                                                                                                                                                                                                                   |
|                    |                                                                                        |           |      	client_shared_path: The path at which volume is mounted on manager,   compute, login node. This value is taken as server_share_path unless   specified otherwise.                                                                                                                                                                                                                                                                                |
|                    |                                                                                        |           |      	client_mount_options: Default value is- nosuid,rw,sync,hard,intr (unless   specified otherwise)                                                                                                                                                                                                                                                                                                                                                  |
|                    |                                                                                        |           |      Must specify atleast 1 volume                                                                                                                                                                                                                                                                                                                                                                                                                    |
+--------------------+----------------------------------------------------------------------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Run the playbook: ::

    cd storage
    ansible-playbook nfs_sas.yml -i /root/inventory -e powervault_username="xxxxx" -e powervault_password="xxxxxx"

* Where the ``inventory`` refers to a list of all nodes in the format of `NFS server inventory file <../../samplefiles.html>`_







