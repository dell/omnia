Configuring storage
=====================

**Configuring Powervault storage**

To configure powervault ME4 and ME5 storage arrays, follow the below steps:

Fill out all required parameters in ``storage/powervault_input.yml``:

.. caution:: Do not remove or comment any lines in the ``storage/powervault_input.yml`` file.

+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter                      | Details                                                                                                                                                                                                                                                   |
+================================+===========================================================================================================================================================================================================================================================+
| powervault_protocol            | This variable   indicates the network protocol used for data connectivity .                                                                                                                                                                               |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Required                  |      **Default values**: ``sas``                                                                                                                                                                                                                          |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_controller_mode     |  This variable   indicates the number of controllers available on the target powervault.                                                                                                                                                                  |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Required                  |      Choices:                                                                                                                                                                                                                                             |
|                                |                                                                                                                                                                                                                                                           |
|                                |      * ``multi``  <- default                                                                                                                                                                                                                              |
|                                |      * ``single``                                                                                                                                                                                                                                         |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_locale              | Represents the   selected language. Currently, only English is supported.                                                                                                                                                                                 |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Optional                  |      **Default values**: ``English``                                                                                                                                                                                                                      |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_system_name         | The system name used to identify the PowerVault Storage   device. The name should be less than 30 characters and must not contain   spaces.                                                                                                               |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Optional                  |      **Default values**: ``Unintialized_Name``                                                                                                                                                                                                            |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_snmp_notify_level   | Select the SNMP   notification levels for PowerVault Storage devices.                                                                                                                                                                                     |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Required                  |      **Default values**: ``none``                                                                                                                                                                                                                         |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_pool_type           | This variable indicates the kind of pool created on the   target powervault.                                                                                                                                                                              |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Required                  |      Choices:                                                                                                                                                                                                                                             |
|                                |                                                                                                                                                                                                                                                           |
|                                |      * ``linear``  <- default                                                                                                                                                                                                                             |
|                                |      * ``virtual``                                                                                                                                                                                                                                        |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_raid_levels         | Enter the   required RAID levels and the minimum / maximum number of disks for each RAID   levels.                                                                                                                                                        |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Optional                  |      Choices:                                                                                                                                                                                                                                             |
|                                |                                                                                                                                                                                                                                                           |
|                                |      * ``raid1``  <- default                                                                                                                                                                                                                              |
|                                |      * ``raid5``                                                                                                                                                                                                                                          |
|                                |      * ``raid6``                                                                                                                                                                                                                                          |
|                                |      * ``raid10``                                                                                                                                                                                                                                         |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_disk_range          | Enter the range of disks in the format   enclosure-number.disk-range,enclosure-number.disk-range. For example, to   select disks 3 to 12 in enclosure 1 and to select disks 5 to 23 in enclosure   2, you must enter 1.3-12, 2.5-23.                      |
|      ``string``                |      A RAID 10 or 50 disk group with disks in subgroups are separated by colons   (with no spaces). RAID-10 example:1.1-2:1.3-4:1.7,1.10                                                                                                                  |
|      Required                  |      Note: Ensure that the entered disk location is empty and the Usage column   lists the range as AVAIL. The disk range specified must be of the same vendor   and they must have the same description.                                                 |
|                                |                                                                                                                                                                                                                                                           |
|                                |      **Default values**: ``0.0-1``                                                                                                                                                                                                                        |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_disk_group_name     | Specifies the   disk group name                                                                                                                                                                                                                           |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Required                  |      **Default values**: ``omnia``                                                                                                                                                                                                                        |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_volumes             | Specify the volume details for powervault and NFS Server   node. Multiple volumes can be defined as comma separated values. example:   omnia_home1, omnia_home2.                                                                                          |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Required                  |      **Default values**: ``omnia_home``                                                                                                                                                                                                                   |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_volume_size         | Enter the   volume size in the format: SizeGB.                                                                                                                                                                                                            |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Required                  |      **Default values**: ``100GB``                                                                                                                                                                                                                        |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_pool                | Enter the pool for the volume.                                                                                                                                                                                                                            |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Required                  |      Choices:                                                                                                                                                                                                                                             |
|                                |                                                                                                                                                                                                                                                           |
|                                |      * ``a``  <- default                                                                                                                                                                                                                                  |
|                                |      * ``A``                                                                                                                                                                                                                                              |
|                                |      * ``B``                                                                                                                                                                                                                                              |
|                                |      * ``b``                                                                                                                                                                                                                                              |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_disk_partition_size | Specify the   disk partition size as a percentage of available disk space.                                                                                                                                                                                |
|      ``integer``               |                                                                                                                                                                                                                                                           |
|      Optional                  |                                                                                                                                                                                                                                                           |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_server_nic          |  Enter the NIC of the   server to which the PowerVault Storage is connected.  Make sure the nfs server also has 3 nics   (for internet, OS provision and powervault connection). The nic should be   specified based on the provisioned OS on nfs server. |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Optional                  |                                                                                                                                                                                                                                                           |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| snmp_trap_destination          |  The trap destination IP address is the IP   address of the SNMP Server where the trap will be sent. If this variable is   left blank, SNMP will be disabled. Omnia will not validate this IP.                                                            |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Optional                  |                                                                                                                                                                                                                                                           |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| snmp_community_name            | The SNMP   community string used to access statistics, MAC addresses and IPs stored   within a router or other device.                                                                                                                                    |
|      ``string``                |                                                                                                                                                                                                                                                           |
|      Optional                  |      **Default values**: ``public``                                                                                                                                                                                                                       |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Run the playbook: ::

    cd storage
    ansible-playbook powervault.yml -i inventory -e powervault_username="" -e powervault_password=""

* Where the ``inventory`` refers to a list of all nodes separated by a newline.

* ``powervault_username`` and ``powervault_password`` are the credentials used to administrate the array.

.. note:: Once the storage is successfully set up, set ``enable_omnia_nfs`` (``input/omnia_config.yml``) to false and  ``omnia_usrhome_share`` (``input/omnia_config.yml``) to an accessible share path in BeeGFS to use the path across the cluster for deployments.

**Configuring NFS servers**

To configure an NFS server, enter the following parameters in ``storage/nfs_server_input.yml``

+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter          | Details                                                                                                                                                                                                                                                                                                                                                                                                                                             |
+====================+=====================================================================================================================================================================================================================================================================================================================================================================================================================================================+
| powervault_ip      | Mandatory field when nfs group is defined with an IP and omnia is   required to configure nfs server. IP of Powervault connected to NFS Server   should be provided. In a single run of omnia, only one NFS Server is   configured. To configure multiple NFS Servers, add one IP in nfs group   in a single run of omnia.yml and give variable values accordingly. To   configure another nfs node, update variables and run ``nfs_sas.yml``       |
|      ``string``    |                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|      Optional      |                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| powervault_volumes | Specify the volume details for   powervault and NFS Server node                                                                                                                                                                                                                                                                                                                                                                                     |
|      ``JSON list`` | For multiple volumes, list of json with volume details should be   provided.                                                                                                                                                                                                                                                                                                                                                                        |
|      Required      |                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                    |      	* ``server_share_path``: The path at which volume is mounted on   nfs node                                                                                                                                                                                                                                                                                                                                                                 |
|                    |      	* ``server_export_options``: Default value is- rw,sync,no_root_squash   (unless specified otherwise). For a list of accepted options, `click here   <https://linux.die.net/man/5/exports>`_                                                                                                                                                                                                                                                |
|                    |      	* ``client_shared_path``: The path at which volume is mounted on manager,   compute, login node. This value is taken as server_share_path unless   specified otherwise.                                                                                                                                                                                                                                                                    |
|                    |      	* ``client_mount_options``: Default value is- nosuid,rw,sync,hard,intr   (unless specified otherwise). For a list of accepted options, `click here   <https://man7.org/linux/man-pages/man8/mount.8.html>`_                                                                                                                                                                                                                                |
|                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                    | Must specify atleast 1 volume                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                    |      **Default values**: `` - { name: omnia_home, server_share_path:   /home/omnia_home, server_export_options: }``                                                                                                                                                                                                                                                                                                                                 |
+--------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Run the playbook: ::

    cd storage
    ansible-playbook nfs_sas.yml -i /root/inventory -e powervault_username="xxxxx" -e powervault_password="xxxxxx"

* Where the ``inventory`` refers to a list of all nodes in the format of `NFS server inventory file <../../samplefiles.html>`_
* To set up NFS client services, `click here <../BuildingClusters/NFS.html>`_






