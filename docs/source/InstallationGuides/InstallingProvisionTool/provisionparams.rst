Input parameters for the provision tool
------------------------------------

Fill in all provision-specific parameters in ``input/provision_config.yml``

.. caution:: Do not remove or comment any lines in the ``input/provision_config.yml`` file.

+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter                        | Details                                                                                                                                                                                                                                                                                                                   |
+==================================+===========================================================================================================================================================================================================================================================================================================================+
| network_interface_type           | The network type used on the Omnia cluster.                                                                                                                                                                                                                                                                               |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | Choices:                                                                                                                                                                                                                                                                                                                  |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  |      * ``lom`` <- default                                                                                                                                                                                                                                                                                                 |
|                                  |      * ``dedicated``                                                                                                                                                                                                                                                                                                      |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| discovery_mechanism              | The mechanism through which Omnia will discover nodes for provisioning.   For more information on how the mechanisms work, go to `DiscoveryMechanisms   <DiscoveryMechanisms/index.html>`_.                                                                                                                               |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | Choices:                                                                                                                                                                                                                                                                                                                  |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  |      * ``switch_based`` <-default                                                                                                                                                                                                                                                                                         |
|                                  |      * ``mapping``                                                                                                                                                                                                                                                                                                        |
|                                  |      * ``bmc``                                                                                                                                                                                                                                                                                                            |
|                                  |      * ``snmpwalk``                                                                                                                                                                                                                                                                                                       |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| provision_os                     | The operating system to be provisioned on target nodes in the   cluster.                                                                                                                                                                                                                                                  |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | Choices:                                                                                                                                                                                                                                                                                                                  |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  |      * ``rhel`` <-default                                                                                                                                                                                                                                                                                                 |
|                                  |      * ``rocky``                                                                                                                                                                                                                                                                                                          |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| provision_os_version             | OS version of provision_os to be installed.                                                                                                                                                                                                                                                                               |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | Choices:                                                                                                                                                                                                                                                                                                                  |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  |      * ``8.0``                                                                                                                                                                                                                                                                                                            |
|                                  |      * ``8.1``                                                                                                                                                                                                                                                                                                            |
|                                  |      * ``8.2``                                                                                                                                                                                                                                                                                                            |
|                                  |      * ``8.3``                                                                                                                                                                                                                                                                                                            |
|                                  |      * ``8.4``                                                                                                                                                                                                                                                                                                            |
|                                  |      * ``8.5``                                                                                                                                                                                                                                                                                                            |
|                                  |      * ``8.6``  <- default                                                                                                                                                                                                                                                                                                |
|                                  |      * ``8.7``                                                                                                                                                                                                                                                                                                            |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| iso_file_path                    | Path where user has placed the iso image that needs to be provisioned on   target nodes. Accepted files are Rocky8-DVD or RHEL-8.x-DVD (full OS).  iso_file_path  should contain the  provision_os  and    provision_os_version  values in   the  filename.                                                               |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | **Default values**:   ``"/home/RHEL-8.6.0-20220420.3-x86_64-dvd1.iso"``                                                                                                                                                                                                                                                   |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| timezone                         | Timezone to be used during OS provisioning. Available timezones are   provided `here <../../Appendix.html>`_.                                                                                                                                                                                                             |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | Choices:                                                                                                                                                                                                                                                                                                                  |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  |      * ``GMT`` <- default                                                                                                                                                                                                                                                                                                 |
|                                  |      * ``EST``                                                                                                                                                                                                                                                                                                            |
|                                  |      * ``CET``                                                                                                                                                                                                                                                                                                            |
|                                  |      * ``MST``                                                                                                                                                                                                                                                                                                            |
|                                  |      * ``CST6CDT``                                                                                                                                                                                                                                                                                                        |
|                                  |      * ``PST8PDT``                                                                                                                                                                                                                                                                                                        |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| language                         | Language to be used during OS provisioning.                                                                                                                                                                                                                                                                               |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | **Default values**: ``en-US``                                                                                                                                                                                                                                                                                             |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| default_lease_time               | Default lease time for IPs assigned by DHCP. Range: 21600-86400                                                                                                                                                                                                                                                           |
|      ``integer``                 |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | **Default values**: ``86400``                                                                                                                                                                                                                                                                                             |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| provision_password               | * Password set for the root account of target nodes during   provisioning.                                                                                                                                                                                                                                                |
|      ``string``                  | * Length >= 8 characters                                                                                                                                                                                                                                                                                                  |
|      Required                    | * Password must not contain -,\, ',"                                                                                                                                                                                                                                                                                      |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| postgresdb_password              | * Password set for the postgresDB on target nodes during   provisioning.                                                                                                                                                                                                                                                  |
|      ``string``                  | * Length >= 8 characters                                                                                                                                                                                                                                                                                                  |
|      Required                    | * Password must not contain -,\, ',"                                                                                                                                                                                                                                                                                      |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| node_name                        | * Prefix for target node names, if dynamically allocated.                                                                                                                                                                                                                                                                 |
|      ``string``                  | * Hostname = node_name + '0000x' + domain_name                                                                                                                                                                                                                                                                            |
|      Required                    | * Hostname <= 65 characters                                                                                                                                                                                                                                                                                               |
|                                  | * Example: servernode00001.Omnia.test , where  node_name =servernode,  domain_name =Omnia.test , 00001 used by   Omnia.                                                                                                                                                                                                   |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  | **Default values**: ``node``                                                                                                                                                                                                                                                                                              |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| domain_name                      | * Domain name the user intends to configure on the cluster.                                                                                                                                                                                                                                                               |
|      ``string``                  | * Hostname = node_name + '0000x' + domain_name                                                                                                                                                                                                                                                                            |
|      Required                    | * Hostname <= 65 characters                                                                                                                                                                                                                                                                                               |
|                                  | * Please provide a valid domain name according to the domain name   standards.                                                                                                                                                                                                                                            |
|                                  | * Example: servernode00001.Omnia.test , where node_name=servernode,   domain_name=Omnia.test , 00001 used by Omnia.                                                                                                                                                                                                       |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| public_nic                       | The NIC/ethernet card that is connected to the public internet.                                                                                                                                                                                                                                                           |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | **Default values**: ``eno2``                                                                                                                                                                                                                                                                                              |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| admin_nic                        | Admin NIC of Control Plane. This is the shared LOM NIC.                                                                                                                                                                                                                                                                   |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | **Default values**: ``eno1``                                                                                                                                                                                                                                                                                              |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| admin_nic_subnet                 | The subnet within which all Admin IPs are assigned.                                                                                                                                                                                                                                                                       |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | **Default values**: ``10.5.0.0``                                                                                                                                                                                                                                                                                          |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| pxe_mapping_file_path            | * The mapping file consists of the MAC address and its respective IP   address and hostname.                                                                                                                                                                                                                              |
|      ``string``                  | * If static IPs are required, create a csv file in the format   MAC,Hostname,IP.                                                                                                                                                                                                                                          |
|      Optional                    | * A sample file is provided here: examples/pxe_mapping_file.csv.                                                                                                                                                                                                                                                          |
|                                  | * If not provided, ensure that pxe_switch_ip is provided.                                                                                                                                                                                                                                                                 |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| switch_based_details             | * JSON list of switches to query for target nodes.                                                                                                                                                                                                                                                                        |
|      ``JSON List``               |                                                                                                                                                                                                                                                                                                                           |
|      Required: switch_based      | * Example: ::                                                                                                                                                                                                                                                                                                             |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  |       - { ip: 172.96.28.12, ports:   '1-48,49:3,50' }                                                                                                                                                                                                                                                                     |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  | * Example with 2 switches: ::                                                                                                                                                                                                                                                                                             |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  |        - { ip: 172.96.28.12, ports: '1-48,49:3,50' }                                                                                                                                                                                                                                                                      |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  |        - { ip: 172.96.28.14, ports: '1,2,3,5' }                                                                                                                                                                                                                                                                           |
|                                  |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| switch_snmp3_username            | The non-admin SNMPv3 username for the switch.                                                                                                                                                                                                                                                                             |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required: switch_based      |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| switch_snmp3_password            | The non-admin SNMPv3 password for the switch.                                                                                                                                                                                                                                                                             |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required: switch_based      |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ip_start_range                   | * The IP start range for all the NICs within the subnets mentioned   above.(Admin, BMC, IB).                                                                                                                                                                                                                              |
|      ``string``                  | * Example: For the range x.y.0.1 to x.y.0.100 with  admin_nic_subnet = 10.5.0.0, target nodes   will be assigned admin IPs between 10.5.0.1 and 10.5.0.100.                                                                                                                                                               |
|      Required                    |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ip_end_range                     | * The IP end range for all the NICs within the subnets mentioned   above.(Admin, BMC, IB).                                                                                                                                                                                                                                |
|      ``string``                  | * Example: For the range x.y.0.1 to x.y.0.100 with  admin_nic_subnet = 10.5.0.0, target nodes   will be assigned admin IPs between 10.5.0.1 and 10.5.0.100.                                                                                                                                                               |
|      Required                    |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ib_nic_subnet                    | * If provided, Omnia will handle and assign static IPs to compute node's   IB network.                                                                                                                                                                                                                                    |
|      ``string``                  | * Only the last 16 bits/2 octets of IPv4 are dynamic                                                                                                                                                                                                                                                                      |
|      Optional                    | * If provided, the DB entry will be in parallel with the pxe_subnet.                                                                                                                                                                                                                                                      |
|                                  | * Example: If ``admin_ip``: 10.5.0.50 and ``ib_nic_subnet``: 10.10.0.0,   then ``ib_ip``: 10.10.0.50                                                                                                                                                                                                                      |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bmc_nic_subnet                   | * If provided, Omnia will assign static IPs to IB NICs on the compute   nodes within the provided subnet.                                                                                                                                                                                                                 |
|      ``string``                  | * Note that since the last 16 bits/2 octets of IPv4 are dynamic, please   ensure that the parameter value is set to x.x.0.0.                                                                                                                                                                                              |
|      Optional                    | * When the PXE range and BMC subnet are provided, corresponding NICs will   be assigned IPs with the same 3rd and 4th octets.                                                                                                                                                                                             |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bmc_username                     | * The username for iDRAC.                                                                                                                                                                                                                                                                                                 |
|      ``string``                  | * The username must not contain -,\, ',"                                                                                                                                                                                                                                                                                  |
|      Required                    |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bmc_password                     | * The password for iDRAC.                                                                                                                                                                                                                                                                                                 |
|      ``string``                  | * The password must not contain -,\, ',"                                                                                                                                                                                                                                                                                  |
|      Required                    |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bmc_static_start_range           | * The dhcp range for discovering the static IP assigned iDRACs within the   given range.                                                                                                                                                                                                                                  |
|      ``string``                  | * For the range 10.3.0.50 to 10.3.4.100 then, bmc_static_start_range:   10.3.0.50, bmc_static_end_range: 10.3.4.100                                                                                                                                                                                                       |
|      Required                    | * To create a meaningful range of discovery, ensure that the last two   octets of ``bmc_static_end_range`` are equal to or greater than the last two   octets of the ``bmc_static_start_range``. That is, for the range a.b.c.d -   a.b.e.f, e and f should be greater than or equal to c and d.                          |
|                                  | * Ex: 172.20.0.50 - 172.20.1.101 is a valid range however, 172.20.0.101 -   172.20.1.50 is not.                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bmc_static_end_range             | * The dhcp range for discovering the static IP assigned iDRACs within the   given range.                                                                                                                                                                                                                                  |
|      ``string``                  | * For the range 10.3.0.50 to 10.3.4.100 then, bmc_static_start_range:   10.3.0.50, bmc_static_end_range: 10.3.4.100                                                                                                                                                                                                       |
|      Required                    | * To create a meaningful range of discovery, ensure that the last two   octets of ``bmc_static_end_range`` are equal to or greater than the last two   octets of the ``bmc_static_start_range``. That is, for the range a.b.c.d -   a.b.e.f, e and f should be greater than or equal to c and d.                          |
|                                  | * Ex: 172.20.0.50 - 172.20.1.101 is a valid range however, 172.20.0.101 -   172.20.1.50 is not.                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| pxe_switch_ip                    | * PXE switch that will be connected to all iDRACs for provisioning                                                                                                                                                                                                                                                        |
|      ``string``                  | * Ensure that SNMP is enabled on the mentioned switch.                                                                                                                                                                                                                                                                    |
|      Required                    |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| pxe_switch_snmp_community_string | The SNMP community string used to access statistics, MAC addresses and   IPs stored within a router or other device.                                                                                                                                                                                                      |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Required                    | **Default values**: ``public``                                                                                                                                                                                                                                                                                            |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| primary_dns                      | The primary DNS host IP queried to provide Internet access to Compute   Node (through DHCP routing)                                                                                                                                                                                                                       |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Optional                    |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| secondary_dns                    | The secondary DNS host IP queried to provide Internet access to Compute   Node (through DHCP routing)                                                                                                                                                                                                                     |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Optional                    |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| disk_partition                   | * User defined disk partition applied to remote servers.                                                                                                                                                                                                                                                                  |
|      ``JSON list``               | * The disk partition desired_capacity has to be provided in MB.                                                                                                                                                                                                                                                           |
|      Optional                    | * Valid mount_point values accepted for disk partition are /home, /var,   /tmp, /usr, swap.                                                                                                                                                                                                                               |
|                                  | * Default partition size provided for /boot is 1024MB, /boot/efi is 256MB   and the remaining space to / partition.                                                                                                                                                                                                       |
|                                  | * Values are accepted in the form of JSON list such as: , - { mount_point:   "/home", desired_capacity: "102400" }                                                                                                                                                                                                        |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  |                                                                                                                                                                                                                                                                                                                           |
|                                  |      **Default values**: ``- { mount_point: "", desired_capacity:   "" }``                                                                                                                                                                                                                                                |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| mlnx_ofed_path                   | Absolute path to a  local copy of   the .iso file containing Mellanox OFED packages. The image can be downloaded   from https://network.nvidia.com/products/infiniband-drivers/linux/mlnx_ofed/.  Sample value:    /root/MLNX_OFED_LINUX-5.8-1.1.2.1-rhel8.6-x86_64.iso                                                   |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Optional                    |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| cuda_toolkit_path                | Absolute path to local copy of .rpm file containing CUDA packages. The   cuda rpm can be downloaded from https://developer.nvidia.com/cuda-downloads.   CUDA will be installed post provisioning without any user intervention. Eg:   cuda_toolkit_path: "/root/cuda-repo-rhel8-12-0-local-12.0.0_525.60.13-1.x86_64.rpm" |
|      ``string``                  |                                                                                                                                                                                                                                                                                                                           |
|      Optional                    |                                                                                                                                                                                                                                                                                                                           |
+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. note::

    The ``input/provision_config.yml`` file is encrypted on the first run of the provision tool:
        To view the encrypted parameters: ::

            ansible-vault view provision_config.yml --vault-password-file .provision_vault_key

        To edit the encrypted parameters: ::

            ansible-vault edit provision_config.yml --vault-password-file .provision_vault_key

.. caution::

    * The IP address *192.168.25.x* is used for PowerVault Storage communications. Therefore, do not use this IP address for other configurations.
    * The IP range *x.y.246.1* - *x.y.255.253* (where x and y are provided by the first two octets of ``bmc_nic_subnet``) are reserved by Omnia.