bmc
---

For automatic provisioning of servers and discovery, the BMC method can be used.

**Pre requisites**

- The control plane NIC connected to remote servers (through the switch) should be configured with two IPs in a shared LOM set up. This NIC is configured by Omnia with the IP xx.yy.255.254, aa.bb.255.254 (where xx.yy are taken from ``bmc_nic_subnet`` and aa.bb are taken from ``admin_nic_subnet``) when ``discovery_mechanism`` is set to ``bmc``.

.. image:: ../../../../images/ControlPlaneNic.png

- IP ranges (``bmc_static_start_range``, ``bmc_static_start_range``) provided to Omnia for BMC discovery should be within the same subnet.

.. note:: To create a meaningful range of discovery, ensure that the last two octets of   ``bmc_static_end_range`` are equal to or greater than the last two octets of   the ``bmc_static_start_range``. That is, for the range a.b.c.d - a.b.e.f, e   and f should be greater than or equal to c and d. *Ex: 172.20.0.50 -   172.20.1.101 is a valid range however,    172.20.0.101 - 172.20.1.50 is not.*

- All iDRACs should be reachable from the ``admin_nic``.

.. note::
    *When iDRACs are in DHCP mode**
        *  The IP range *x.y.246.1* - *x.y.255.253* (where x and y are provided by the first two octets of ``bmc_nic_subnet``) are reserved by Omnia.
        * *x.y.246.1* - *x.y.250.253* will be the range of IPs reserved for dynamic assignment by Omnia.
        * During provisioning, Omnia updates servers to static mode and assigns IPs from *x.y.251.1* - *x.y.255.253*.
        * Users can see the IPs (that have been assigned from *x.y.251.1* - *x.y.255.253*) in the DB after provisioning the servers.
        * For example:
            If the provided ``bmc_subnet`` is ``10.3.0.0`` and there are two iDRACs in DHCP mode, the IPs assigned will be ``10.3.251.1`` and ``10.3.251.2``.

The following parameters need to be populated in ``input/provision_config.yml`` to discover target nodes using BMC.

+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Variable               | Default, Choices                                | Required/Optional | Description                                                                                                                                                                                                                                                                                                                                                                                                                                              |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| network_interface_type | **lom**, dedicated                              | Required          | The network type used on the Omnia cluster.                                                                                                                                                                                                                                                                                                                                                                                                              |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| discovery_mechanism    | **switch_based**, mapping, bmc, snmpwalk        | Required          | The mechanism through which Omnia will discover nodes for provisioning.   For more information on how the mechanisms work, go to `DiscoveryMechanisms   <DiscoveryMechanisms/index.html>`_.                                                                                                                                                                                                                                                              |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| provision_os           | **rhel**, rocky                                 | Required          | The operating system to be provisioned on target nodes in the   cluster.                                                                                                                                                                                                                                                                                                                                                                                 |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| provision_os_version   | 8.0, 8.1, 8.2, 8.3, 8.4, 8.5, **8.6**, 8.7      | Required          | OS version of provision_os to be installed.                                                                                                                                                                                                                                                                                                                                                                                                              |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| iso_file_path          | "/home/RHEL-8.6.0-20220420.3-x86_64-dvd1.iso"   | Required          | Path where user has placed the iso image that needs to be   provisioned on target nodes. Accepted files are Rocky8-DVD or RHEL-8.x-DVD   (full OS). ``iso_file_path`` should contain the ``provision_os`` and   ``provision_os_version`` values in filename.                                                                                                                                                                                             |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| timezone               | **GMT**,  EST, CET, MST, CST6CDT,   PST8PDT     | Required          | Timezone to be used during OS provisioning. Available timezones are   provided in ``provision/roles/provision_validation/files/timezone.txt``.                                                                                                                                                                                                                                                                                                           |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| language               | **en-US**                                       | Required          | Language to be used during OS provisioning.                                                                                                                                                                                                                                                                                                                                                                                                              |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| default_lease_time     | **86400** [21600-86400]                         | Required          | Default lease time for IPs assigned by DHCP                                                                                                                                                                                                                                                                                                                                                                                                              |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| provision_password     |                                                 | Required          | * Password set for the root account of target nodes during   provisioning.                                                                                                                                                                                                                                                                                                                                                                               |
|                        |                                                 |                   | * Length >= 8 characters                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                        |                                                 |                   | * Password must not contain -,\, ',"                                                                                                                                                                                                                                                                                                                                                                                                                     |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| postgresdb_password    |                                                 | Required          | * Password set for the postgresDB on target nodes during   provisioning.                                                                                                                                                                                                                                                                                                                                                                                 |
|                        |                                                 |                   | * Length >= 8 characters                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                        |                                                 |                   | * Password must not contain -,\, ',"                                                                                                                                                                                                                                                                                                                                                                                                                     |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| node_name              | node                                            | Required          | * Prefix for target node names, if dynamically allocated.                                                                                                                                                                                                                                                                                                                                                                                                |
|                        |                                                 |                   | * Hostname = node_name + '0000x' + domain_name                                                                                                                                                                                                                                                                                                                                                                                                           |
|                        |                                                 |                   | * Hostname <= 65 characters                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                        |                                                 |                   | * Example: servernode00001.Omnia.test , where ``node_name``=servernode,   ``domain_name``=Omnia.test , 00001 used by Omnia.                                                                                                                                                                                                                                                                                                                              |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| domain_name            |                                                 | Required          | * Domain name the user intends to configure on the cluster.                                                                                                                                                                                                                                                                                                                                                                                              |
|                        |                                                 |                   | * Hostname = node_name + '0000x' + domain_name                                                                                                                                                                                                                                                                                                                                                                                                           |
|                        |                                                 |                   | * Hostname <= 65 characters                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                        |                                                 |                   | * Please provide a valid domain name according to the domain name   standards.                                                                                                                                                                                                                                                                                                                                                                           |
|                        |                                                 |                   | * Example: servernode00001.Omnia.test , where ``node_name``=servernode,   ``domain_name``=Omnia.test , 00001 used by Omnia.                                                                                                                                                                                                                                                                                                                              |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| public_nic             | eno2                                            | Required          | The nic/ethernet card that is connected to the public internet.                                                                                                                                                                                                                                                                                                                                                                                          |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| admin_nic              | eno1                                            | Required          | Admin NIC of Control Plane. This is the shared LOM NIC.                                                                                                                                                                                                                                                                                                                                                                                                  |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| admin_nic_subnet *     | 10.5.0.0                                        | Required          | The subnet within which all Admin IPs are assigned.                                                                                                                                                                                                                                                                                                                                                                                                      |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ib_nic_subnet *        |                                                 | Optional          | If provided, Omnia will handle and assign static IPs to compute node's IB   network.  If provided the db entry will   be in parallel with the ``pxe_subnet``. Example: If admin_ip: 10.5.0.50 and   ib_nic_subnet: 10.10.0.0, then ib_ip: 10.10.0.50. __Note:__ Ensure that IB   NICs have ib as a prefix.                                                                                                                                               |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bmc_nic_subnet *       |                                                 | Optional          | If provided, Omnia will handle and assign IPs to the iDRACs.   If provided the db entry will be in parallel with either the ``pxe_subnet``   or whatever is provided in mapping file. Example: If ``admin_ip``: 10.5.0.101   and ``bmc_nic_subnet``: 10.3.0.0, then ``bmc_ip``: 10.3.0.101                                                                                                                                                               |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bmc_static_start_range                                                   | optional          | The start of the IP range for iDRACs in static mode. Ex: 172.20.0.50 -   172.20.1.101 is a valid range however,    172.20.0.101 - 172.20.1.50 is not.                                                                                                                                                                                                                                                                                                    |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bmc_static_end_range   |                                                 | optional          | The end of the IP range for iDRACs in static mode. **Note**: To create a   meaningful range of discovery, ensure that the last two octets of   ``bmc_static_end_range`` are equal to or greater than the last two octets of   the ``bmc_static_start_range``. That is, for the range a.b.c.d - a.b.e.f, e   and f should be greater than or equal to c and d.                                                                                            |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bmc_username           |                                                 | optional          | The username for iDRAC. The username must not contain -,\, ',".   Required only if iDRAC_support: true and the discovery mechanism is BMC.                                                                                                                                                                                                                                                                                                               |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bmc_password           |                                                 | optional          | The password for iDRAC. The username must not contain -,\, ',".   Required only if iDRAC_support: true and the discovery mechanism is BMC.                                                                                                                                                                                                                                                                                                               |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| primary_dns            |                                                 | optional          | The primary DNS host IP queried to provide Internet access to Compute   Node (through DHCP routing)                                                                                                                                                                                                                                                                                                                                                      |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| secondary_dns          |                                                 | optional          | The secondary DNS host IP queried to provide Internet access to Compute   Node (through DHCP routing)                                                                                                                                                                                                                                                                                                                                                    |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| disk_partition         |   - { mount_point: "",   desired_capacity: "" } | optional          | User defined disk partition applied to remote servers. The disk partition   desired_capacity has to be provided in MB. Valid mount_point values accepted   for disk partition are /home, /var, /tmp, /usr, swap. Default partition size   provided for /boot is 1024MB, /boot/efi is 256MB and the remaining space to /   partition.  Values are accepted in the   form of JSON list such as: , - { mount_point: "/home",   desired_capacity: "102400" } |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| mlnx_ofed_path         |                                                 | optional          | Absolute path to a  local copy of   the .iso file containing Mellanox OFED packages. The image can be downloaded   from https://network.nvidia.com/products/infiniband-drivers/linux/mlnx_ofed/.  Sample value:   ``/root/MLNX_OFED_LINUX-5.8-1.1.2.1-rhel8.6-x86_64.iso``                                                                                                                                                                               |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| cuda_toolkit_path      |                                                 | optional          | Absolute path to local copy of .rpm file containing CUDA packages. The   cuda rpm can be downloaded from https://developer.nvidia.com/cuda-downloads.   CUDA will be installed post provisioning without any user intervention. Eg:   cuda_toolkit_path: "/root/cuda-repo-rhel8-12-0-local-12.0.0_525.60.13-1.x86_64.rpm"                                                                                                                                |
+------------------------+-------------------------------------------------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. warning:: The IP address *192.168.25.x* is used for PowerVault Storage communications. Therefore, do not use this IP address for other configurations.


To continue to the next steps:

* `Provisioning the cluster <../installprovisiontool.html>`_